                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              var MeshLine=function(){function t(t){var e=new Float32Array(2*t.length);return t.forEach(function(t,r){e[2*r]=t.x,e[2*r+1]=t.y,e[2*r+2]=t.z}),e}function e(t){var e=new Float32Array(2*t.length);return t.forEach(function(t,r){e[2*r]=t.x,e[2*r+1]=t.y,e[2*r+2]=t.z}),e}function r(t,e){var r=[],n=new THREE.Vector3,a=new THREE.Vector3,o=0;return t.forEach(function(s,u){o=u/(t.length-1),n.copy(s),a.copy(t[u+1]),u<t.length-1&&e(o)&&r.push(n,a)}),r}var n="precision mediump float;\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform vec2 resolution;\nuniform float lineWidth;\nuniform vec3 color;\nuniform float opacity;\nuniform float near;\nuniform float far;\nuniform float sizeAttenuation;\n\nattribute vec3 position;\nattribute vec3 previous;\nattribute vec3 next;\nattribute float side;\nattribute float width;\nattribute vec2 uv;\n\nvarying vec2 vUV;\nvarying vec4 vColor;\nvarying float vCounters;\n\nvarying vec3 vPosition;\nvarying vec3 vPrevious;\nvarying vec3 vNext;\n\nvec2 fix( vec4 i, float aspect ) {\n\n    vec2 res = i.xy / i.w;\n    res.x *= aspect;\n\t vCounters = i.w;\n    return res;\n\n}\n\nvoid main() {\n\n    float aspect = resolution.x / resolution.y;\n\t float pixelWidthRatio = 1. / (resolution.x * projectionMatrix[0][0]);\n\n    vColor = vec4( color, opacity );\n    vUV = uv;\n\n    mat4 m = projectionMatrix * modelViewMatrix;\n    vec4 finalPosition = m * vec4( position, 1.0 );\n    vec4 prevPos = m * vec4( previous, 1.0 );\n    vec4 nextPos = m * vec4( next, 1.0 );\n\n    vec2 currentP = fix( finalPosition, aspect );\n    vec2 prevP = fix( prevPos, aspect );\n    vec2 nextP = fix( nextPos, aspect );\n\n\t float pixelWidth = finalPosition.w * pixelWidthRatio;\n    float w = 1.8 * lineWidth * width * pixelWidth;\n\tif( sizeAttenuation == 0. ) w = 1.8 * lineWidth * width;\n\n    vec2 dir;\n    if( nextP == currentP ) dir = normalize( currentP - prevP );\n    else if( prevP == currentP ) dir = normalize( nextP - currentP );\n    else {\n        vec2 dir1 = normalize( currentP - prevP );\n        vec2 dir2 = normalize( nextP - currentP );\n        dir = normalize( dir1 + dir2 );\n\n        vec2 perp = vec2( -dir1.y, dir1.x );\n        vec2 miter = vec2( -dir.y, dir.x );\n        //w = w / dot( miter, perp );\n    }\n\n    vec2 normal = vec2( -dir.y, dir.x );\n    normal.x /= aspect;\n    normal *= .5 * w;\n\n    vec4 offset = vec4( normal * side, 0.0, 1.0 );\n    finalPosition.xy += offset.xy;\n\n    gl_Position = finalPosition;\n\n\t vPosition = position;\n\t vPrevious = previous;\n\t vNext = next;\n\n}\n",a="precision mediump float;\n\nuniform sampler2D map;\nuniform float useMap;\nuniform float useDash;\nuniform float dashArray;\nuniform float dashOffset;\nuniform float dashRatio;\nuniform float visibility;\n\nvarying vec2 vUV;\nvarying vec4 vColor;\nvarying float vCounters;\n\nvoid main() {\n\n    vec4 c = vColor;\n    if( useMap == 1. ) c *= texture2D( map, vUV );\n\t if( useDash == 1. ){     \n\t \t c.a *= ceil(mod(vCounters + dashOffset, dashArray) - (dashArray * dashRatio));\n\t }\n    gl_FragColor = c;\n\t gl_FragColor.a *= visibility;\n}\n";this.positions=[],this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],this.counters=[],this.geometry=new THREE.BufferGeometry,THREE.BufferGeometry.call(this),this.type="MeshLine",this.positions=[],this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],this.counters=[],this.geometry=new THREE.BufferGeometry},MeshLine.prototype=Object.create(THREE.BufferGeometry.prototype),MeshLine.prototype.constructor=MeshLine,MeshLine.prototype.setPoints=function(n,a){this.positions=[];for(var o=0;o<n.length;o++)this.positions.push(n[o].x,n[o].y,n[o].z);this.process(a)},MeshLine.prototype.setPoints=function(e,r){this.positions=[];for(var n=0;n<e.length;n++){var a=e[n],o=a.x,s=a.y,u=a.z;this.positions.push(o,s,u)}this.process(r)},MeshLine.prototype.setGeometry=function(r,n){if(r instanceof THREE.Geometry){this.setPoints(r.vertices,n)}else if(r instanceof THREE.BufferGeometry){this.setPoints(r.getAttribute("position").array,n)}else if(r instanceof Float32Array||r instanceof Array){this.setPoints(r,n)}else this.setPoints(r.points,n)},MeshLine.prototype.process=function(r){for(var n=this.positions.length/3,a=0;a<n;a++)0==a?this.counters.push(0):this.counters.push(this.counters[a-1]+new THREE.Vector3(this.positions[3*(a-1)],this.positions[3*(a-1)+1],this.positions[3*(a-1)+2]).distanceTo(new THREE.Vector3(this.positions[3*a],this.positions[3*a+1],this.positions[3*a+2])));this.positions=new Float32Array(this.positions),this.previous=new Float32Array(this.positions),this.next=new Float32Array(this.positions),this.side=new Float32Array(2*n),this.width=new Float32Array(2*n),this.indices_array=new Uint16Array(2*(n-1)),this.uvs=new Float32Array(2*n);for(var o=0;o<n;o++){this.side[2*o]=-1,this.side[2*o+1]=1;var s=r?r(o/n):1;this.width[2*o]=s,this.width[2*o+1]=s,this.uvs[2*o]=o/(n-1),this.uvs[2*o+1]=0,this.uvs[2*o+2]=o/(n-1),this.uvs[2*o+3]=1}for(var u,l=this.positions.length,c=0;c<n-1;c++)u=2*c,this.indices_array[6*c]=u,this.indices_array[6*c+1]=u+1,this.indices_array[6*c+2]=u+2,this.indices_array[6*c+3]=u+2,this.indices_array[6*c+4]=u+1,this.indices_array[6*c+5]=u+3;this.previous=new Float32Array(this.positions),this.previous.set(this.positions.subarray(0,l-3),3),this.previous.set(this.positions.subarray(l-6,l-3),0),this.next=new Float32Array(this.positions),this.next.set(this.positions.subarray(3),0),this.next.set(this.positions.subarray(l-3),l-3),this.addAttribute("position",new THREE.BufferAttribute(this.positions,3)),this.addAttribute("previous",new THREE.BufferAttribute(this.previous,3)),this.addAttribute("next",new THREE.BufferAttribute(this.next,3)),this.addAttribute("side",new THREE.BufferAttribute(this.side,1)),this.addAttribute("width",new THREE.BufferAttribute(this.width,1)),this.addAttribute("uv",new THREE.BufferAttribute(this.uvs,2)),this.addAttribute("counters",new THREE.BufferAttribute(new Float32Array(t(this.counters)),1)),this.setIndex(new THREE.BufferAttribute(this.indices_array,1)),this.computeBoundingSphere()},MeshLineMaterial=function(t){var e={lineWidth:1,map:null,useMap:0,alphaTest:.5,color:new THREE.Color(16777215),opacity:1,resolution:new THREE.Vector2(1,1),sizeAttenuation:1,near:1,far:1,dashArray:0,dashOffset:0,dashRatio:.5,useDash:0,visibility:1,transparent:!0,side:THREE.DoubleSide};t=t||{};var r={};r.lineWidth={type:"f",value:e.lineWidth},r.map={type:"t",value:e.map},r.useMap={type:"f",value:e.useMap},r.alphaTest={type:"f",value:e.alphaTest},r.color={type:"c",value:e.color},r.opacity={type:"f",value:e.opacity},r.resolution={type:"v2",value:e.resolution},r.sizeAttenuation={type:"f",value:e.sizeAttenuation},r.near={type:"f",value:e.near},r.far={type:"f",value:e.far},r.dashArray={type:"f",value:e.dashArray},r.dashOffset={type:"f",value:e.dashOffset},r.dashRatio={type:"f",value:e.dashRatio},r.useDash={type:"f",value:e.useDash},r.visibility={type:"f",value:e.visibility},THREE.ShaderMaterial.call(this,{uniforms:r,vertexShader:n,fragmentShader:a,transparent:e.transparent,side:e.side}),this.type="MeshLineMaterial";for(var o in e)r[o].value=void 0!==t[o]?t[o]:e[o];this.lineWidth=r.lineWidth.value,this.map=r.map.value,this.useMap=r.useMap.value,this.color=r.color.value,this.opacity=r.opacity.value,this.resolution=r.resolution.value,this.sizeAttenuation=r.sizeAttenuation.value,this.near=r.near.value,this.far=r.far.value,this.dashArray=r.dashArray.value,this.dashOffset=r.dashOffset.value,this.dashRatio=r.dashRatio.value,this.useDash=r.useDash.value,this.visibility=r.visibility.value},MeshLineMaterial.prototype=Object.create(THREE.ShaderMaterial.prototype),MeshLineMaterial.prototype.constructor=MeshLineMaterial,MeshLineMaterial.prototype.copy=function(t){THREE.ShaderMaterial.prototype.copy.call(this,t),this.lineWidth=t.lineWidth,this.map=t.map,this.useMap=t.useMap,this.color.copy(t.color),this.opacity=t.opacity,this.resolution.copy(t.resolution),this.sizeAttenuation=t.sizeAttenuation,this.near=t.near,this.far=t.far,this.dashArray=t.dashArray,this.dashOffset=t.dashOffset,this.dashRatio=t.dashRatio,this.useDash=t.useDash,this.visibility=t.visibility};